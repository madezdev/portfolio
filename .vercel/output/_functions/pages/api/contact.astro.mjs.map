{"version":3,"file":"contact.astro.mjs","sources":["../../../../src/pages/api/contact.ts"],"sourcesContent":["import type { APIRoute } from 'astro';\nimport nodemailer from 'nodemailer';\n\nexport const POST: APIRoute = async ({ request }) => {\n  try {\n    const data = await request.json();\n    \n    // Validate required fields\n    const { name, email, subject, message } = data;\n    if (!name || !email || !subject || !message) {\n      return new Response(\n        JSON.stringify({ \n          success: false, \n          error: 'Todos los campos requeridos deben estar completos' \n        }),\n        { \n          status: 400,\n          headers: {\n            'Content-Type': 'application/json'\n          }\n        }\n      );\n    }\n\n    // Validate email format\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      return new Response(\n        JSON.stringify({ \n          success: false, \n          error: 'Por favor ingresa un email v√°lido' \n        }),\n        { \n          status: 400,\n          headers: {\n            'Content-Type': 'application/json'\n          }\n        }\n      );\n    }\n\n    // Create nodemailer transporter\n    const transporter = nodemailer.createTransport({\n      host: import.meta.env.SMTP_HOST || 'smtp.gmail.com',\n      port: parseInt(import.meta.env.SMTP_PORT || '587'),\n      secure: import.meta.env.SMTP_SECURE === 'true', // true for 465, false for other ports\n      auth: {\n        user: import.meta.env.SMTP_USER,\n        pass: import.meta.env.SMTP_PASS\n      },\n      // Add debug info\n      debug: true,\n      logger: true\n    });\n\n    // Test the connection\n    try {\n      await transporter.verify();\n      console.log('SMTP connection verified successfully');\n    } catch (verifyError: any) {\n      console.error('SMTP verification failed:', verifyError);\n      throw new Error(`SMTP configuration error: ${verifyError.message}`);\n    }\n\n    // Email template for owner\n    const ownerEmailHTML = `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; }\n            .header { background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: white; padding: 20px; text-align: center; }\n            .content { padding: 20px; background: #f8fafc; }\n            .field { margin-bottom: 15px; }\n            .label { font-weight: bold; color: #4a5568; }\n            .value { background: white; padding: 10px; border-radius: 5px; border-left: 4px solid #3b82f6; }\n            .footer { text-align: center; padding: 20px; color: #6b7280; font-size: 14px; }\n          </style>\n        </head>\n        <body>\n          <div class=\"header\">\n            <h1>üì¨ Nuevo Mensaje de Contacto</h1>\n            <p>Portfolio - madez.dev</p>\n          </div>\n          \n          <div class=\"content\">\n            <div class=\"field\">\n              <div class=\"label\">üë§ Nombre:</div>\n              <div class=\"value\">${name}</div>\n            </div>\n            \n            <div class=\"field\">\n              <div class=\"label\">üìß Email:</div>\n              <div class=\"value\">${email}</div>\n            </div>\n            \n            <div class=\"field\">\n              <div class=\"label\">üìù Asunto:</div>\n              <div class=\"value\">${subject}</div>\n            </div>\n            \n            ${data.budget ? `\n              <div class=\"field\">\n                <div class=\"label\">üí∞ Presupuesto:</div>\n                <div class=\"value\">${data.budget}</div>\n              </div>\n            ` : ''}\n            \n            <div class=\"field\">\n              <div class=\"label\">üí¨ Mensaje:</div>\n              <div class=\"value\">${message.replace(/\\n/g, '<br>')}</div>\n            </div>\n          </div>\n          \n          <div class=\"footer\">\n            <p>Este mensaje fue enviado desde tu formulario de contacto en madez.dev</p>\n            <p>üìÖ ${new Date().toLocaleDateString('es-ES', { \n              weekday: 'long', \n              year: 'numeric', \n              month: 'long', \n              day: 'numeric',\n              hour: '2-digit',\n              minute: '2-digit'\n            })}</p>\n          </div>\n        </body>\n      </html>\n    `;\n\n    // Email template for sender (confirmation)\n    const senderEmailHTML = `\n      <!DOCTYPE html>\n      <html>\n        <head>\n          <meta charset=\"utf-8\">\n          <style>\n            body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; max-width: 600px; margin: 0 auto; }\n            .header { background: linear-gradient(135deg, #10b981, #3b82f6); color: white; padding: 20px; text-align: center; }\n            .content { padding: 20px; background: #f8fafc; }\n            .message { background: white; padding: 20px; border-radius: 10px; border-left: 4px solid #10b981; }\n            .footer { text-align: center; padding: 20px; color: #6b7280; font-size: 14px; }\n            .cta { text-align: center; margin: 20px 0; }\n            .button { display: inline-block; background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; font-weight: bold; }\n          </style>\n        </head>\n        <body>\n          <div class=\"header\">\n            <h1>‚úÖ Mensaje Recibido</h1>\n            <p>¬°Gracias por contactarme!</p>\n          </div>\n          \n          <div class=\"content\">\n            <p>Hola <strong>${name}</strong>,</p>\n            \n            <div class=\"message\">\n              <p>üì¨ He recibido tu mensaje y te responder√© lo antes posible, generalmente en menos de 24 horas.</p>\n              \n              <p><strong>Resumen de tu mensaje:</strong></p>\n              <ul>\n                <li><strong>Asunto:</strong> ${subject}</li>\n                <li><strong>Email:</strong> ${email}</li>\n                ${data.budget ? `<li><strong>Presupuesto:</strong> ${data.budget}</li>` : ''}\n              </ul>\n            </div>\n            \n            <p>Mientras tanto, puedes:</p>\n            <ul>\n              <li>üîó Conectar conmigo en <a href=\"https://linkedin.com/in/madezdev\">LinkedIn</a></li>\n              <li>üíº Ver mis proyectos en <a href=\"https://github.com/madezdev\">GitHub</a></li>\n              <li>üí¨ Enviarme un mensaje directo por <a href=\"https://wa.me/5491133266874\">WhatsApp</a></li>\n            </ul>\n            \n            <div class=\"cta\">\n              <a href=\"https://madez.dev\" class=\"button\">üåê Visitar Portfolio</a>\n            </div>\n            \n            <p>¬°Espero trabajar contigo pronto!</p>\n            <p><strong>Martin</strong><br>\n            Full Stack Developer & UX/UI Designer</p>\n          </div>\n          \n          <div class=\"footer\">\n            <p>Este es un email autom√°tico de confirmaci√≥n</p>\n            <p>üìß madezdev@gmail.com | üåê madez.dev</p>\n          </div>\n        </body>\n      </html>\n    `;\n\n    // Send email to owner\n    await transporter.sendMail({\n      from: `\"Portfolio Contact\" <${import.meta.env.SMTP_USER}>`,\n      to: import.meta.env.SMTP_USER,\n      subject: `üíº Nuevo contacto: ${subject} - ${name}`,\n      html: ownerEmailHTML,\n      replyTo: email\n    });\n\n    // Send confirmation email to sender\n    await transporter.sendMail({\n      from: `\"Martin - Portfolio\" <${import.meta.env.SMTP_USER}>`,\n      to: email,\n      subject: '‚úÖ Mensaje recibido - Te responder√© pronto',\n      html: senderEmailHTML\n    });\n\n    return new Response(\n      JSON.stringify({ \n        success: true, \n        message: 'Email enviado correctamente' \n      }),\n      { \n        status: 200,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      }\n    );\n\n  } catch (error: any) {\n    console.error('Error sending email:', error);\n    \n    // Provide more specific error messages\n    let errorMessage = 'Error interno del servidor. Por favor intenta m√°s tarde.';\n    \n    if (error.message?.includes('SMTP')) {\n      errorMessage = 'Error de configuraci√≥n SMTP. Verifica las credenciales.';\n    } else if (error.message?.includes('authentication')) {\n      errorMessage = 'Error de autenticaci√≥n. Verifica el usuario y contrase√±a SMTP.';\n    } else if (error.message?.includes('connection')) {\n      errorMessage = 'Error de conexi√≥n SMTP. Verifica host y puerto.';\n    }\n    \n    return new Response(\n      JSON.stringify({ \n        success: false, \n        error: errorMessage,\n        details: process.env.NODE_ENV === 'development' ? error.message : undefined\n      }),\n      { \n        status: 500,\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      }\n    );\n  }\n};"],"names":[],"mappings":"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"}