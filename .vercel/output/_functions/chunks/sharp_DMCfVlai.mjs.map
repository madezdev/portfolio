{"version":3,"file":"sharp_DMCfVlai.mjs","sources":["../../../node_modules/astro/dist/assets/services/sharp.js"],"sourcesContent":["import { AstroError, AstroErrorData } from \"../../core/errors/index.js\";\nimport {\n  baseService,\n  parseQuality\n} from \"./service.js\";\nlet sharp;\nconst qualityTable = {\n  low: 25,\n  mid: 50,\n  high: 80,\n  max: 100\n};\nasync function loadSharp() {\n  let sharpImport;\n  try {\n    sharpImport = (await import(\"sharp\")).default;\n  } catch {\n    throw new AstroError(AstroErrorData.MissingSharp);\n  }\n  sharpImport.cache(false);\n  return sharpImport;\n}\nconst fitMap = {\n  fill: \"fill\",\n  contain: \"inside\",\n  cover: \"cover\",\n  none: \"outside\",\n  \"scale-down\": \"inside\",\n  outside: \"outside\",\n  inside: \"inside\"\n};\nconst sharpService = {\n  validateOptions: baseService.validateOptions,\n  getURL: baseService.getURL,\n  parseURL: baseService.parseURL,\n  getHTMLAttributes: baseService.getHTMLAttributes,\n  getSrcSet: baseService.getSrcSet,\n  async transform(inputBuffer, transformOptions, config) {\n    if (!sharp) sharp = await loadSharp();\n    const transform = transformOptions;\n    if (transform.format === \"svg\") return { data: inputBuffer, format: \"svg\" };\n    const result = sharp(inputBuffer, {\n      failOnError: false,\n      pages: -1,\n      limitInputPixels: config.service.config.limitInputPixels\n    });\n    result.rotate();\n    const withoutEnlargement = Boolean(transform.fit);\n    if (transform.width && transform.height && transform.fit) {\n      const fit = fitMap[transform.fit] ?? \"inside\";\n      result.resize({\n        width: Math.round(transform.width),\n        height: Math.round(transform.height),\n        fit,\n        position: transform.position,\n        withoutEnlargement\n      });\n    } else if (transform.height && !transform.width) {\n      result.resize({\n        height: Math.round(transform.height),\n        withoutEnlargement\n      });\n    } else if (transform.width) {\n      result.resize({\n        width: Math.round(transform.width),\n        withoutEnlargement\n      });\n    }\n    if (transform.format) {\n      let quality = void 0;\n      if (transform.quality) {\n        const parsedQuality = parseQuality(transform.quality);\n        if (typeof parsedQuality === \"number\") {\n          quality = parsedQuality;\n        } else {\n          quality = transform.quality in qualityTable ? qualityTable[transform.quality] : void 0;\n        }\n      }\n      const isGifInput = inputBuffer[0] === 71 && // 'G'\n      inputBuffer[1] === 73 && // 'I'\n      inputBuffer[2] === 70 && // 'F'\n      inputBuffer[3] === 56 && // '8'\n      (inputBuffer[4] === 57 || inputBuffer[4] === 55) && // '9' or '7'\n      inputBuffer[5] === 97;\n      if (transform.format === \"webp\" && isGifInput) {\n        result.webp({ quality: typeof quality === \"number\" ? quality : void 0, loop: 0 });\n      } else {\n        result.toFormat(transform.format, { quality });\n      }\n    }\n    const { data, info } = await result.toBuffer({ resolveWithObject: true });\n    return {\n      data,\n      format: info.format\n    };\n  }\n};\nvar sharp_default = sharpService;\nexport {\n  sharp_default as default\n};\n"],"names":["AstroErrorData.MissingSharp"],"mappings":"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","x_google_ignoreList":[0]}