import{a as E}from"./store.BxErYl_R.js";/*! js-cookie v3.0.5 | MIT */function p(e){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var a in i)e[a]=i[a]}return e}var V={read:function(e){return e[0]==='"'&&(e=e.slice(1,-1)),e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(e){return encodeURIComponent(e).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function m(e,n){function i(o,f,s){if(!(typeof document>"u")){s=p({},n,s),typeof s.expires=="number"&&(s.expires=new Date(Date.now()+s.expires*864e5)),s.expires&&(s.expires=s.expires.toUTCString()),o=encodeURIComponent(o).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var l="";for(var u in s)s[u]&&(l+="; "+u,s[u]!==!0&&(l+="="+s[u].split(";")[0]));return document.cookie=o+"="+e.write(f,o)+l}}function a(o){if(!(typeof document>"u"||arguments.length&&!o)){for(var f=document.cookie?document.cookie.split("; "):[],s={},l=0;l<f.length;l++){var u=f[l].split("="),R=u.slice(1).join("=");try{var y=decodeURIComponent(u[0]);if(s[y]=e.read(R,y),o===y)break}catch{}}return o?s[o]:s}}return Object.create({set:i,get:a,remove:function(o,f){i(o,"",p({},f,{expires:-1}))},withAttributes:function(o){return m(this.converter,p({},this.attributes,o))},withConverter:function(o){return m(p({},this.converter,o),this.attributes)}},{attributes:{value:Object.freeze(n)},converter:{value:Object.freeze(e)}})}var c=m(V,{path:"/"});const t=[];for(let e=0;e<256;++e)t.push((e+256).toString(16).slice(1));function z(e,n=0){return(t[e[n+0]]+t[e[n+1]]+t[e[n+2]]+t[e[n+3]]+"-"+t[e[n+4]]+t[e[n+5]]+"-"+t[e[n+6]]+t[e[n+7]]+"-"+t[e[n+8]]+t[e[n+9]]+"-"+t[e[n+10]]+t[e[n+11]]+t[e[n+12]]+t[e[n+13]]+t[e[n+14]]+t[e[n+15]]).toLowerCase()}let v;const T=new Uint8Array(16);function j(){if(!v){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");v=crypto.getRandomValues.bind(crypto)}return v(T)}const B=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),D={randomUUID:B};function _(e,n,i){if(D.randomUUID&&!e)return D.randomUUID();e=e||{};const a=e.random??e.rng?.()??j();if(a.length<16)throw new Error("Random bytes length must be >= 16");return a[6]=a[6]&15|64,a[8]=a[8]&63|128,z(a)}const b={batchSize:10,flushInterval:3e4},L=()=>typeof window>"u"?!1:c.get("analytics_consent")==="true",J=()=>{if(typeof window>"u")return!1;const e=c.get("analytics_consent"),n=c.get("consent_banner_dismissed");return e===void 0&&n!=="true"},w=E(L()),S=E(J());let r=null,d=null,g=[];const A=()=>{if(typeof window<"u"){const e=c.get("analytics_consent"),n=c.get("consent_banner_dismissed");console.log("Initializing consent:",{consent:e,consentBannerDismissed:n}),console.log("Current banner state:",S.get()),console.log("Current consent state:",w.get()),e==="true"&&!r&&(r=U(),d=C(r.id),console.log("Analytics already accepted, initialized user and session"))}},O=()=>{if(typeof window>"u")return"server-user";let e=c.get("portfolio_user_id");return e||(e=_(),c.set("portfolio_user_id",e,{expires:365})),e},k=()=>{if(typeof window>"u")return"server-session";let e=sessionStorage.getItem("portfolio_session_id");return e||(e=_(),sessionStorage.setItem("portfolio_session_id",e)),e},U=()=>{const e=O(),n=F(e);if(n)return n.lastVisit=Date.now(),n.totalSessions+=1,h(n),n;const i={id:e,firstVisit:Date.now(),lastVisit:Date.now(),totalSessions:1,totalPageViews:0,totalInteractions:0,preferredLanguage:navigator.language.startsWith("es")?"es":"en"};return h(i),i},C=e=>{const i={id:k(),userId:e,startTime:Date.now(),pageViews:0,interactions:0,language:navigator.language.startsWith("es")?"es":"en",referrer:document.referrer,userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight}};return x(i),i},F=e=>{if(typeof window>"u")return null;const n=localStorage.getItem(`analytics_user_${e}`);return n?JSON.parse(n):null},h=e=>{typeof window>"u"||localStorage.setItem(`analytics_user_${e.id}`,JSON.stringify(e))},x=e=>{typeof window>"u"||sessionStorage.setItem(`analytics_session_${e.id}`,JSON.stringify(e))},N=()=>{if(typeof window>"u")return[];const e=localStorage.getItem("analytics_events");return e?JSON.parse(e):[]},W=e=>{typeof window>"u"||localStorage.setItem("analytics_events",JSON.stringify(e))},$=(e,n={})=>{if(!w.get()||typeof window>"u")return;r||(r=U()),d||(d=C(r.id));const i={id:_(),sessionId:d.id,userId:r.id,timestamp:Date.now(),type:e,data:{...n,page:window.location.pathname,referrer:document.referrer,userAgent:navigator.userAgent,viewport:{width:window.innerWidth,height:window.innerHeight}}};g.push(i),e==="page_view"?(d.pageViews++,r.totalPageViews++):(d.interactions++,r.totalInteractions++),h(r),x(d),g.length>=b.batchSize&&I()},I=()=>{if(g.length===0)return;const n=[...N(),...g];W(n),g=[],H(n.slice(-10))},H=async e=>{try{await fetch("/api/analytics",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({events:e})})}catch(n){console.warn("Failed to send analytics events to server:",n)}},M=()=>{console.log("Analytics accepted"),w.set(!0),S.set(!1),c.set("analytics_consent","true",{expires:365}),c.set("consent_banner_dismissed","true",{expires:365}),typeof window<"u"&&(r=U(),d=C(r.id),$("page_view"))},Q=()=>{if(console.log("Analytics declined"),w.set(!1),S.set(!1),c.set("analytics_consent","false",{expires:365}),c.set("consent_banner_dismissed","true",{expires:365}),typeof window<"u"){localStorage.removeItem("analytics_events");const e=O();localStorage.removeItem(`analytics_user_${e}`),sessionStorage.removeItem("portfolio_session_id")}};typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",A):A(),setInterval(I,b.flushInterval),window.addEventListener("beforeunload",I),window.addEventListener("beforeunload",()=>{d&&(d.endTime=Date.now(),x(d))}));export{w as a,M as b,Q as d,S as s,$ as t};
